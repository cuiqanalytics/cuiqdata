[pipeline]
name = "MySQL Orders Analysis"
description = "Analyze orders from MySQL: join with users, calculate totals, export results"
schedule = ""
timeout_minutes = 5

[[steps]]
name = "load_users"
type = "ingest"
source = "mysql://localhost:3306/testdb?table=users"
output_table = "users"
query = ""

[[steps]]
name = "load_orders"
type = "ingest"
source = "mysql://localhost:3306/testdb?table=orders"
output_table = "orders"
query = ""

[[steps]]
name = "join_and_aggregate"
type = "transform"
output_table = "user_order_summary"
query = """
CREATE TABLE user_order_summary AS
SELECT 
    u.id,
    u.name,
    u.country,
    COUNT(o.id) as order_count,
    SUM(o.amount) as total_spent,
    AVG(o.amount) as avg_order_value
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.name, u.country
ORDER BY total_spent DESC
"""

[[steps]]
name = "export_summary"
type = "sink"
input_table = "user_order_summary"
destination = "output/user_order_summary.parquet"
query = ""
